sap.ui.define(["./BaseController","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel"],function(e,s,i,n,o,r){"use strict";return e.extend("com.app.library.controller.Home",{onInit:function(){var e=new i("/v2/BookSRV/");this.getView().setModel(e);const s=new r({username:"",password:"",email:"",FullName:"",Address:"",Phone:"",userType:"user"});this.getView().setModel(s,"localModel")},onBtnClick:function(){var e=this.getView();var i=e.byId("user").getValue();var r=e.byId("pwd").getValue();if(!i||!r){s.show("please enter username and password.");return}var t=this.getView().getModel();t.read("/User",{filters:[new n("username",o.EQ,i),new n("password",o.EQ,r)],success:function(e){if(e.results.length>0){var i=e.results[0].ID;var n=e.results[0].userType;s.show("Login Successful");if(n==="user"){var o=this.getOwnerComponent().getRouter();o.navTo("RouteUser",{id:i})}else{var o=this.getOwnerComponent().getRouter();o.navTo("RouteAdmin",{id:i})}}else{s.show("Invalid username or password.")}}.bind(this),error:function(){s.show("An error occured during login.")}})},onloginBtnClick:async function(){if(!this.oLoginDialog){this.oLoginDialog=await this.loadFragment("LoginDialog")}this.oLoginDialog.open()},oncancelbtn:function(){if(this.oLoginDialog.isOpen()){this.oLoginDialog.close()}},onCloseDialog:function(){if(this.oLoginDialog&&this.oLoginDialog.isOpen()){this.oLoginDialog.close()}},signupBtnClick:async function(){const e=this.getView().getModel("localModel").getProperty("/"),i=this.getView().getModel("modelv2");if(e.username&&e.password){}else{sap.m.MessageBox.error("Please enter valid details");return}var n=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;var o=/^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$/;if(!(n.test(e.email)&&o.test(e.Phone))){s.show("please enter valid email and password");return}try{var r=await this.checkUserName(i,e.username,e.password);var t=await this.checkEmail(i,e.email);var a=await this.checkPhone(i,e.Phone);if(r){s.show("User already exsist");return}if(t){s.show("Email already exsist for another user please enter vaild email ");return}if(a){s.show("PhoneNumber already exsist for another user please enter valid Phonenumber");return}await this.createData(i,e,"/User");this.oSignupDialog.close();s.show("SignUp Successful")}catch(e){this.oSignupDialog.close();sap.m.MessageBox.error("Some technical Issue")}},checkUserName:async function(e,s,i){return new Promise((r,t)=>{e.read("/User",{filters:[new n("username",o.EQ,s),new n("password",o.EQ,i)],success:function(e){r(e.results.length>0)},error:function(){t("An error occurred while checking username existence.")}})})},checkEmail:async function(e,s){return new Promise((i,r)=>{e.read("/User",{filters:[new n("email",o.EQ,s)],success:function(e){i(e.results.length>0)},error:function(){r("An error occurred while checking username existence.")}})})},checkPhone:async function(e,s){return new Promise((i,r)=>{e.read("/User",{filters:[new n("Phone",o.EQ,s)],success:function(e){i(e.results.length>0)},error:function(){r("An error occurred while checking username existence.")}})})},onClickSignUp:async function(){if(!this.oSignupDialog){this.oSignupDialog=await this.loadFragment("SignUpDialogue")}this.oSignupDialog.open()},onsignupcancelbtn:function(){if(this.oSignupDialog.isOpen()){this.oSignupDialog.close()}}})});