sap.ui.define(["./BaseController","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/ui/core/Fragment"],function(e,i,n,o,s,a,t){"use strict";return e.extend("com.app.library.controller.Home",{onInit:function(){var e=new n("/v2/BookSRV/");this.getView().setModel(e);const i=new a({username:"",password:"",email:"",FullName:"",Address:"",Phone:"",userType:"user"});this.getView().setModel(i,"localModel")},onBtnClick:function(){var e=this.getView();var n=e.byId("user").getValue();var a=e.byId("pwd").getValue();if(!n||!a){i.show("please enter username and password.");return}var t=this.getView().getModel();t.read("/User",{filters:[new o("username",s.EQ,n),new o("password",s.EQ,a)],success:function(e){if(e.results.length>0){var n=e.results[0].ID;var o=e.results[0].userType;i.show("Login Successful");if(o==="user"){var s=this.getOwnerComponent().getRouter();s.navTo("RouteUser",{id:n})}else{var s=this.getOwnerComponent().getRouter();s.navTo("RouteAdmin",{id:n})}}else{i.show("Invalid username or password.")}}.bind(this),error:function(){i.show("An error occured during login.")}})},onloginBtnClick:async function(){if(!this.oLoginDialog){this.oLoginDialog=await this.loadFragment("LoginDialog")}this.oLoginDialog.open()},oncancelbtn:function(){if(this.oLoginDialog.isOpen()){this.oLoginDialog.close()}},onCloseDialog:function(){if(this.oLoginDialog&&this.oLoginDialog.isOpen()){this.oLoginDialog.close()}},signupBtnClick:async function(){const e=this.getView().getModel("localModel").getProperty("/"),n=this.getView().getModel("modelv2");if(e.username&&e.password){}else{sap.m.MessageBox.error("Please enter valid details");return}var o=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;var s=/^(?:(?:\+|0{0,2})91(\s*[\-]\s*)?|[0]?)?[789]\d{9}$/;if(!(o.test(e.email)&&s.test(e.Phone))){i.show("please enter valid email and password");return}try{var a=await this.checkUserName(n,e.username,e.password);var t=await this.checkEmail(n,e.email);var r=await this.checkPhone(n,e.Phone);if(a){i.show("User already exsist");return}if(t){i.show("Email already exsist for another user please enter vaild email ");return}if(r){i.show("PhoneNumber already exsist for another user please enter valid Phonenumber");return}await this.createData(n,e,"/User");this.oSignupDialog.close();i.show("SignUp Successful")}catch(e){this.oSignupDialog.close();sap.m.MessageBox.error("Some technical Issue")}},checkUserName:async function(e,i,n){return new Promise((a,t)=>{e.read("/User",{filters:[new o("username",s.EQ,i),new o("password",s.EQ,n)],success:function(e){a(e.results.length>0)},error:function(){t("An error occurred while checking username existence.")}})})},checkEmail:async function(e,i){return new Promise((n,a)=>{e.read("/User",{filters:[new o("email",s.EQ,i)],success:function(e){n(e.results.length>0)},error:function(){a("An error occurred while checking username existence.")}})})},checkPhone:async function(e,i){return new Promise((n,a)=>{e.read("/User",{filters:[new o("Phone",s.EQ,i)],success:function(e){n(e.results.length>0)},error:function(){a("An error occurred while checking username existence.")}})})},onClickSignUp:async function(){if(!this.oSignupDialog){this.oSignupDialog=await this.loadFragment("SignUpDialogue")}this.oSignupDialog.open()},onsignupcancelbtn:function(){if(this.oSignupDialog.isOpen()){this.oSignupDialog.close()}},onhandleCompanyQuickViewPress:async function(){if(!this.notificationDialog1){this.notificationDialog1=await this.loadFragment("HomePageCompanyDetails")}this.notificationDialog1.open()},onAdminDetailscancelbtn:function(){this.notificationDialog1.open();this.notificationDialog1.close()},AvailableBooksBtn:async function(){if(!this.libraryinfo){this.libraryinfo=await this.loadFragment("libraryinfo")}this.libraryinfo.open()},onlibraryclosedialog:function(){if(this.libraryinfo.isOpen()){this.libraryinfo.close()}}})});