sap.ui.define(["./BaseController","sap/m/MessageToast","sap/ui/model/odata/v2/ODataModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel"],function(e,o,s,i,n,t){"use strict";return e.extend("com.app.library.controller.Home",{onInit:function(){var e=new s("/v2/BookSRV/");this.getView().setModel(e);const o=new t({username:"",password:"",email:"",FullName:"",Address:"",Phone:"",userType:"user"});this.getView().setModel(o,"localModel")},onBtnClick:function(){var e=this.getView();var s=e.byId("user").getValue();var t=e.byId("pwd").getValue();if(!s||!t){o.show("please enter username and password.");return}var a=this.getView().getModel();a.read("/User",{filters:[new i("username",n.EQ,s),new i("password",n.EQ,t)],success:function(e){if(e.results.length>0){var s=e.results[0].ID;var i=e.results[0].userType;o.show("Login Successful");if(i==="user"){var n=this.getOwnerComponent().getRouter();n.navTo("RouteUser",{id:s})}else{var n=this.getOwnerComponent().getRouter();n.navTo("RouteAdmin",{id:s})}}else{o.show("Invalid username or password.")}}.bind(this),error:function(){o.show("An error occured during login.")}})},onloginBtnClick:async function(){if(!this.oLoginDialog){this.oLoginDialog=await this.loadFragment("LoginDialog")}this.oLoginDialog.open()},oncancelbtn:function(){if(this.oLoginDialog.isOpen()){this.oLoginDialog.close()}},onCloseDialog:function(){if(this.oLoginDialog&&this.oLoginDialog.isOpen()){this.oLoginDialog.close()}},signupBtnClick:async function(){const e=this.getView().getModel("localModel").getProperty("/"),s=this.getView().getModel("modelv2");if(e.username&&e.password){}else{sap.m.MessageBox.error("Please enter valid details");return}try{const i=await this.checkUserName(s,e.username,e.password);if(i){o.show("User already exsist");return}await this.createData(s,e,"/User");this.oSignupDialog.close();o.show("SignUp Successful")}catch(e){this.oSignupDialog.close();sap.m.MessageBox.error("Some technical Issue")}},checkUserName:async function(e,o,s){return new Promise((t,a)=>{e.read("/User",{filters:[new i("username",n.EQ,o),new i("password",n.EQ,s)],success:function(e){t(e.results.length>0)},error:function(){a("An error occurred while checking username existence.")}})})},onClickSignUp:async function(){if(!this.oSignupDialog){this.oSignupDialog=await this.loadFragment("SignUpDialogue")}this.oSignupDialog.open()},onsignupcancelbtn:function(){if(this.oSignupDialog.isOpen()){this.oSignupDialog.close()}}})});