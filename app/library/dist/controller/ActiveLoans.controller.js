sap.ui.define(["./BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/Token","sap/ui/model/odata/v2/ODataModel","sap/m/MessageToast"],function(e,t,o,s,n,i,a,r){"use strict";return e.extend("com.app.library.controller.ActiveLoans",{onInit:function(){},setHeaderContext:function(){var e=this.getView();e.byId("idUserLoans").setBindingContext(e.byId("_IDGenTable1").getBinding("items").getHeaderContext())},onButtonCloseLoanPress:async function(){var e=this.byId("idUserLoans").getSelectedItem().getBindingContext().getObject(),t=e.book.ID,o=e.book.Avl_Quantity+1;var s=this.byId("idUserLoans").getSelectedItems();console.log();const n=new sap.ui.model.json.JSONModel({book:{Avl_Quantity:o}});this.getView().setModel(n,"userModel");const i=this.getView().getModel("userModel").getProperty("/"),a=this.getView().getModel("modelv2");try{a.update("/Book("+t+")",i.book,{success:function(){this.getView().byId("idBooksTable").getBinding("items").refresh()},error:function(e){sap.m.MessageBox.error("Failed to update book: "+e.message)}.bind(this)})}catch(e){sap.m.MessageBox.error("Some technical Issue")}var s=this.byId("idUserLoans").getSelectedItems();if(s.length>0){var l=[];s.forEach(function(e){var t=e.getBindingContext().getObject().book.ISBN;l.push(t);e.getBindingContext().delete("$auto")});Promise.all(l.map(function(e){return new Promise(function(t,o){t(e+" Successfully Loan is Closed")})})).then(function(e){e.forEach(function(e){r.show(e)})}).catch(function(e){r.show("Deletion Error: "+e)});this.getView().byId("idBookTable").removeSelections(true)}else{r.show("Please Select Rows to Delete")}location.reload()}})});