sap.ui.define(["./BaseController","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/Token"],function(e,t,o,i,n,s){"use strict";return e.extend("com.app.library.controller.Admin",{onInit:function(){const e=new i({ISBN:"",Title:"",Author:"",Genre:"",No_of_books:"",Description:""});this.getView().setModel(e,"localModel");this.getOwnerComponent().getRouter().attachRoutePatternMatched(this.onBookListLoad,this);const t=this.getView();const o=t.byId("idtitleFilterValue");const n=t.byId("idAuthorFilterValue");const a=t.byId("idGenreFilterValue");const r=t.byId("idISBNFilterValue");let l=function(e){if(true){var t=e.text;return new s({key:t,text:t})}};o.addValidator(l);n.addValidator(l);a.addValidator(l);r.addValidator(l)},setHeaderContext:function(){var e=this.getView();e.byId("Bookstitle").setBindingContext(e.byId("_IDGenTable1").getBinding("items").getHeaderContext())},onBookListLoad:function(){this.getView().byId("idBookTable").getBinding("items").refresh()},onGoPress:function(){const e=this.getView(),i=e.byId("idtitleFilterValue"),n=i.getTokens(),s=e.byId("idAuthorFilterValue"),a=s.getTokens(),r=e.byId("idISBNFilterValue"),l=r.getTokens(),d=e.byId("idGenreFilterValue"),g=d.getTokens(),c=e.byId("idBookTable"),u=[];n.filter(e=>{e?u.push(new t("Title",o.EQ,e.getKey())):""});a.filter(e=>{e?u.push(new t("Author",o.EQ,e.getKey())):""});l.filter(e=>{e?u.push(new t("ISBN",o.EQ,e.getKey())):""});g.filter(e=>{e?u.push(new t("Genre",o.EQ,e.getKey())):""});c.getBinding("items").filter(u)},onClearFilterPress:function(){const e=this.getView(),t=e.byId("idtitleFilterValue"),o=t.removeAllTokens(),i=e.byId("idAuthorFilterValue"),n=i.removeAllTokens(),s=e.byId("idGenreFilterValue"),a=s.removeAllTokens(),r=e.byId("idISBNFilterValue"),l=r.removeAllTokens()},onCreateBtnPress:async function(){if(!this.oCreateEmployeeDialog){this.oCreateEmployeeDialog=await this.loadFragment("CreateBookDialog")}this.oCreateEmployeeDialog.open()},onCloseDialog:function(){if(this.oCreateEmployeeDialog.isOpen()){this.oCreateEmployeeDialog.close()}},oncancelbtnbook:function(){if(this.oCreateEmployeeDialog.isOpen()){this.oCreateEmployeeDialog.close()}},onCreateBook:async function(){debugger;const e=this.getView().getModel("localModel").getProperty("/"),t=this.getView().getModel("modelv2");console.log(typeof e.No_of_books);try{await this.createData(t,e,"/Book");this.getView().byId("idBookTable").getBinding("items").refresh();this.oCreateEmployeeDialog.close()}catch(e){this.oCreateEmployeeDialog.close();n.error("Some technical Issue")}location.reload()},onDeleteBtnPress:async function(){var e=this.byId("idBookTable").getSelectedItems();if(e.length>0){var t=[];e.forEach(function(e){var o=e.getBindingContext().getObject().isbn;t.push(o);e.getBindingContext().delete("$auto")});Promise.all(t.map(function(e){return new Promise(function(t,o){t(e+" Successfully Deleted")})})).then(function(e){e.forEach(function(e){MessageToast.show(e)})}).catch(function(e){MessageToast.show("Deletion Error: "+e)});this.getView().byId("idBookTable").removeSelections(true);this.getView().byId("idBookTable").getBinding("items").refresh()}else{MessageToast.show("Please Select Rows to Delete")}location.reload()},onUpdateBtnPress:async function(){var e=this.byId("idBookTable").getSelectedItem();if(e){var t=e.getBindingContext().getProperty("ID");var o=e.getBindingContext().getProperty("ISBN");var i=e.getBindingContext().getProperty("Author");var n=e.getBindingContext().getProperty("Title");var s=e.getBindingContext().getProperty("Genre");var a=e.getBindingContext().getProperty("No_of_books");var r=e.getBindingContext().getProperty("Description");var l=e.getBindingContext().getProperty("Avl_Quantity");var d=new sap.ui.model.json.JSONModel({ID:t,ISBN:o,Author:i,Title:n,Genre:s,No_of_books:a,Description:r,Avl_Quantity:l});this.getView().setModel(d,"newBookModel");if(!this.oEditBooksDialog){this.oEditBooksDialog=await this.loadFragment("EditBook")}this.oEditBooksDialog.open()}},onSave:function(){var e=this.getView().getModel("newBookModel").getData();var t=this.getOwnerComponent().getModel("modelv2");console.log(t.getMetadata().getName());try{t.update("/Book("+e.ID+")",e,{success:function(){this.getView().byId("idBookTable").getBinding("items").refresh();this.oEditBooksDialog.close()}.bind(this),error:function(e){this.oEditBooksDialog.close();sap.m.MessageBox.error("Failed to update book: "+e.message)}.bind(this)})}catch(e){this.oEditBooksDialog.close();sap.m.MessageBox.error("Some technical Issue")}var t=new sap.ui.model.odata.v2.ODataModel({serviceUrl:"https://port4004-workspaces-ws-dv77z.us10.trial.applicationstudio.cloud.sap/v2/BookSRV",defaultBindingMode:sap.ui.model.BindingMode.TwoWay,messageParser:sap.ui.model.odata.ODataMessageParser})},onClose:function(){if(this.oEditBooksDialog.isOpen()){this.oEditBooksDialog.close()}},onActiveLoans:function(){var e=this.getOwnerComponent().getRouter();e.navTo("RouteActiveLoans")},onIssueBooks:function(){var e=this.getOwnerComponent().getRouter();e.navTo("RouteIssueBooks")},onClickUsers:function(){var e=this.getOwnerComponent().getRouter();e.navTo("RouteAllUsers")}})});