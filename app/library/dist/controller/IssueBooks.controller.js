sap.ui.define(["./BaseController","sap/ui/model/odata/v2/ODataModel","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,o,t,s){"use strict";return e.extend("com.app.library.controller.IssueBooks",{onInit:function(){var e=this.byId("idIssueBooks");var o=e.getColumns()[6];o.setVisible(false)},onIssueBookPress:async function(e){console.log(this.byId("idIssueBooks").getSelectedItem().getBindingContext().getObject());if(this.byId("idIssueBooks").getSelectedItems().length>1){s.show("Please Select only one Book");return}var o=this.byId("idIssueBooks").getSelectedItem().getBindingContext().getObject(),t=o.book.Avl_Quantity-1;console.log(o);var i=new Date;if(i.getMonth()==11){var n=new Date(i.getFullYear()+1,0,1)}else{var n=new Date(i.getFullYear(),i.getMonth()+1);console.log(n)}const a=new sap.ui.model.json.JSONModel({book_ID:o.book.ID,user_ID_ID:o.user_ID.ID,issue_Date:i,due_Date:n,notify:`Hey! Your Reserved Book  title "\n            ${o.book.Title}\n            " is issued`,book:{Avl_Quantity:t}});this.getView().setModel(a,"userModel");const l=this.getView().getModel("userModel").getProperty("/"),d=this.getView().getModel("modelv2");try{await this.createData(d,l,"/BookLoan");sap.m.MessageBox.success("Book is Succesfully Issued");this.byId("idIssueBooks").getSelectedItem().getBindingContext().delete("$auto");d.update("/Book("+o.book.ID+")",l.book,{success:function(){},error:function(e){sap.m.MessageBox.error("Failed to update book: "+e.message)}.bind(this)});var r=this.byId("idIssueBooks");var u=r.getSelectedItem();r.removeItem(u)}catch(e){sap.m.MessageBox.error("Some technical Issue")}}})});